```markdown
# Yalivia æž¶æž„è®¾è®¡æ–‡æ¡£ (Yalivia Runtime Architecture Overview)

> é¢å‘ NuisLang çš„è½»é‡åŒ–è¿è¡Œæ—¶ä¸Žå¼‚æž„æ‰§è¡ŒçŽ¯å¢ƒ  
> â€”â€” â€œCompile for performance, execute for evolution.â€

---

## 1. ç®€ä»‹

**Yalivia** æ˜¯ NuisLang çš„å¯é€‰è¿è¡Œæ—¶çŽ¯å¢ƒï¼ˆOptional Runtime Environmentï¼‰ï¼Œ  
ç”¨äºŽåœ¨å¤šå¹³å°ã€å¼‚æž„ç¡¬ä»¶ä»¥åŠåŠ¨æ€è°ƒè¯•åœºæ™¯ä¸­ï¼Œç»Ÿä¸€æ‰§è¡Œã€è°ƒåº¦å’Œæ‰˜ç®¡ NUIS IR æ¨¡å—ã€‚  

Yalivia çš„å­˜åœ¨å¹¶éžä¸ºäº†æ›¿ä»£åŽŸç”Ÿç¼–è¯‘ï¼ˆNative Executionï¼‰ï¼Œ  
è€Œæ˜¯ä½œä¸ºè¯­è¨€ç”Ÿæ€çš„ã€Œå…¼å®¹å±‚ã€ä¸Žã€Œè¯•éªŒåœºã€ï¼Œ  
ç”¨äºŽéªŒè¯æ–°ç‰¹æ€§ã€æä¾› IR çº§è§£é‡Šæ‰§è¡Œä¸Žå¼‚æž„è®¾å¤‡æ”¯æŒã€‚

---

## 2. æž¶æž„åˆ†å±‚æ¦‚è§ˆ

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NuisLang ç¼–è¯‘å™¨                   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  è¯­æ³•å±‚ (Nuix)   â†’   è¯­ä¹‰å±‚ (Nuis IR)   â†’   LLVM/WASM â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Yalivia Runtime                  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [1] IR Loader & Verifier                          â”‚
â”‚  [2] IR Interpreter / JIT Engine                   â”‚
â”‚  [3] Scheduler / Async Runtime                     â”‚
â”‚  [4] Device Backend Layer (CPU/GPU/FPGA...)        â”‚
â”‚  [5] Memory & Object Model                         â”‚
â”‚  [6] Debugger / Profiler / Tracing Tools           â”‚
â”‚  [7] Plugin & Host Interface                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å¹³å°åŽç«¯ (LLVM / WASM / Native ABI)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## 3. æ¨¡å—èŒè´£åˆ’åˆ†

| æ¨¡å— | èŒè´£è¯´æ˜Ž |
|------|-----------|
| **IR Loader & Verifier** | è´Ÿè´£åŠ è½½ NUIS IR æ¨¡å—ï¼ˆæ–‡æœ¬æˆ–äºŒè¿›åˆ¶ï¼‰ï¼ŒéªŒè¯ç»“æž„ã€ç¬¦å·è¡¨ä¸Žç±»åž‹ä¸€è‡´æ€§ã€‚ |
| **IR Interpreter / JIT** | æ‰§è¡Œ IR æŒ‡ä»¤ï¼ˆSSA å½¢å¼ï¼‰ï¼Œæä¾›è§£é‡Šä¸ŽåŠ¨æ€ç¼–è¯‘ä¸¤ç§æ¨¡å¼ã€‚ |
| **Scheduler / Async Runtime** | è´Ÿè´£ä»»åŠ¡è°ƒåº¦ã€å¼‚æ­¥çŠ¶æ€æœºè¿è¡Œã€åç¨‹ä¸Žå¹¶è¡Œæ¨¡åž‹æ”¯æŒã€‚ |
| **Device Backend Layer** | å¼‚æž„æ‰§è¡Œå±‚ï¼šCPU / GPU / TPU / FPGA / Network Nodeã€‚ |
| **Memory & Object Model** | ç®¡ç†æ ˆå¸§ã€Arena Allocatorã€å¼•ç”¨ä¸Žå¯¹è±¡å¸ƒå±€ã€‚ |
| **Debugger / Profiler** | æ”¯æŒ IR è°ƒè¯•ã€æ€§èƒ½åˆ†æžã€è¿½è¸ªé‡‡æ ·ä¸Žç¬¦å·æ˜ å°„ã€‚ |
| **Plugin & Host Interface** | è¿è¡Œæ—¶æ‰©å±•æŽ¥å£ï¼Œå…è®¸å¤–éƒ¨åŠ è½½åŽŸç”Ÿæˆ– WASM æ¨¡å—ã€‚ |

---

## 4. ä¸Ž NuisLang ç¼–è¯‘å™¨çš„æŽ¥å£å…³ç³»

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Nuis ç¼–è¯‘å™¨                 â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Source â†’ AST â†’ Semantic Analysis â†’ NUIS IR â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
Emit IR æ–‡ä»¶
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Yalivia Runtime              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  åŠ è½½ IR â†’ éªŒè¯ â†’ è§£é‡Š / JIT / è°ƒåº¦æ‰§è¡Œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### æŽ¥å£å½¢å¼
| ç±»åž‹ | è¯´æ˜Ž |
|------|------|
| `*.nir` | äºŒè¿›åˆ¶ IR æ¨¡å—æ–‡ä»¶ï¼ˆä¸»æ ¼å¼ï¼‰ |
| `*.nuit` | æ–‡æœ¬ IRï¼ˆä¾¿äºŽè°ƒè¯•ä¸Žå·¥å…·é“¾ï¼‰ |
| JSON API | é€šè¿‡ IPC / socket æŽ¥å£æä¾›è°ƒè¯•ã€åŠ¨æ€åŠ è½½ã€çŠ¶æ€æŸ¥è¯¢ |
| ABI æŽ¥å£ | C / Rust FFI å½¢å¼åµŒå…¥å¼è°ƒç”¨ï¼ˆ`yalivia_embed` æ¨¡å—ï¼‰ |

---

## 5. æ‰§è¡Œæ¨¡å¼

| æ¨¡å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|-----------|
| **è§£é‡Šæ¨¡å¼ (Interpret)** | é€æŒ‡ä»¤æ‰§è¡Œï¼Œè°ƒè¯•æ€§å¼ºï¼Œå¹³å°å…¼å®¹æ€§æœ€é«˜ | IDE è°ƒè¯•ã€è¯­è¨€åŽŸåž‹éªŒè¯ |
| **JIT æ¨¡å¼ (Just-In-Time)** | åŠ¨æ€ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œå…¼é¡¾æ€§èƒ½ä¸Žçµæ´»æ€§ | é•¿ç”Ÿå‘½å‘¨æœŸç¨‹åºã€æ¨¡åž‹è®­ç»ƒ |
| **AOT æ¡¥æŽ¥æ¨¡å¼** | å°† IR ç¼–è¯‘ä¸º LLVM/WASM æ¨¡å—æ‰§è¡Œ | æ··åˆéƒ¨ç½²ã€è®¾å¤‡å›ºåŒ–è¿è¡Œ |

```

```
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   NUIS IR    â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚               â”‚                        â”‚
      â–¼               â–¼                        â–¼
```

[Interpreter]     [JIT Compiler]           [AOT Backend]
â”‚               â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ‰§è¡Œç»“æžœç»Ÿä¸€è°ƒåº¦

```

---

## 6. å¼‚æž„åŽç«¯è®¾è®¡

Yalivia é€šè¿‡ â€œDevice Backend Layerâ€ å®žçŽ°è·¨ç¡¬ä»¶è°ƒåº¦ä¸Žç»Ÿä¸€è¯­ä¹‰ã€‚  
è¯¥å±‚åŸºäºŽ **DeviceContext** ä¸Ž **ExecutionUnit** æŠ½è±¡æž„å»ºã€‚

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Device Backend Layer           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ + register_backend(name, driver)         â”‚
â”‚ + dispatch(task, device_id)               â”‚
â”‚ + sync(memory_region)                    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ CPU Backend                           â”‚
â”‚  â€¢ GPU Backend (CUDA / ROCm / Vulkan)    â”‚
â”‚  â€¢ TPU Backend                           â”‚
â”‚  â€¢ FPGA Backend                          â”‚
â”‚  â€¢ Remote Execution (RPC / Cluster)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### å¼‚æž„æ‰§è¡Œç¤ºä¾‹

```

function matmul(a, b) -> c:
device = select_device(a, b)
if device == GPU:
yield gpu::kernel.matmul(a, b)
else:
yield cpu::matmul(a, b)

```

---

## 7. å†…å­˜ä¸Žå¯¹è±¡æ¨¡åž‹

| å±‚çº§ | åŠŸèƒ½ | ç‰¹ç‚¹ |
|------|------|------|
| **Arena Allocator** | é«˜é€Ÿçº¿æ€§åˆ†é…ã€ç”Ÿå‘½å‘¨æœŸç»‘å®š | é›¶ GC |
| **Stack Frame** | è°ƒç”¨æ ˆå¸§ç®¡ç†ã€è¿”å›žå€¼åˆ†é… | å¯è¢« IR è°ƒè¯•å™¨è¿½è¸ª |
| **Reference Model** | æ˜¾å¼å¼•ç”¨è®¡æ•°ï¼ˆéžè‡ªåŠ¨å›žæ”¶ï¼‰ | å¯ç”±ç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶é€‰æ‹©ç­–ç•¥ |
| **Layout Descriptor** | IR å±‚å¯¹è±¡å¸ƒå±€æè¿°ç¬¦ | ä¸Ž LLVM æ•°æ®å¸ƒå±€å¯¹é½ |

---

## 8. è°ƒè¯•ä¸Žå¼€å‘å·¥å…·å±‚

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Yalivia Dev Tools Layer         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ IR è°ƒè¯•å™¨ (CLI / TUI)                 â”‚
â”‚  â€¢ Trace Recorder                        â”‚
â”‚  â€¢ Performance Profiler (sampling)       â”‚
â”‚  â€¢ Graph Visualizer (DOT / JSON è¾“å‡º)    â”‚
â”‚  â€¢ Hot Reload Service                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

è¿™äº›å·¥å…·å¯ç‹¬ç«‹è¿è¡Œæˆ–åµŒå…¥ IDEï¼Œ  
ä¸Ž NUIS IR äº¤äº’ï¼Œæ”¯æŒå¯è§†åŒ–æŽ§åˆ¶æµæŸ¥çœ‹ä¸Žå®žæ—¶æ‰§è¡ŒçŠ¶æ€ç›‘æŽ§ã€‚

---

## 9. æ’ä»¶ç³»ç»Ÿä¸Žå®¿ä¸»æŽ¥å£

Yalivia æä¾› **åŠ¨æ€æ‰©å±•æŽ¥å£ (YPI â€“ Yalivia Plugin Interface)**  
ç”¨äºŽåŠ è½½å¤–éƒ¨æ¨¡å—ï¼ˆWASM / C / Rust åŠ¨æ€åº“ï¼‰ã€‚

| ç±»åž‹ | åŠŸèƒ½ | ç¤ºä¾‹ |
|------|------|------|
| **Native Plugin** | é€šè¿‡ FFI åŠ è½½åŽŸç”Ÿå‡½æ•° | æ•°å­¦åº“ã€åŽ‹ç¼©åº“ |
| **WASM Plugin** | åŠ è½½ç‹¬ç«‹æ²™ç›’æ¨¡å— | å®‰å…¨è„šæœ¬æ‰§è¡Œ |
| **IR Extension** | å‘è§£é‡Šå™¨æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤ | DSL æ–¹è¨€æ‰©å±• |

---

## 10. å®‰å…¨ä¸Žç¡®å®šæ€§ç­–ç•¥

- æ‰€æœ‰ IR æ‰§è¡Œä¸º **æ˜¾å¼æŽ§åˆ¶æµ**ï¼Œç¦æ­¢éšå¼å¼‚å¸¸ä¸Ž GCã€‚  
- ä»»åŠ¡è°ƒåº¦å¯é€‰ **ç¡®å®šæ€§æ¨¡å¼ (Deterministic Scheduling)**ã€‚  
- æ²™ç›’å†…å­˜åŸŸï¼ˆIsolated Regionï¼‰ç”¨äºŽæ··åˆä¿¡ä»»è¿è¡Œã€‚  
- æ‰€æœ‰åŽç«¯é©±åŠ¨éœ€é€šè¿‡ Verifier æ³¨å†Œæœºåˆ¶ã€‚  

---

## 11. æ¼”åŒ–è·¯çº¿å›¾ï¼ˆRoadmapï¼‰

| é˜¶æ®µ | å†…å®¹ | çŠ¶æ€ |
|------|------|------|
| Phase 0 | IR è®¾è®¡ä¸ŽéªŒè¯å™¨å®žçŽ° | âœ… è®¾è®¡ä¸­ |
| Phase 1 | è§£é‡Šå™¨ä¸Žè°ƒè¯•å™¨åŽŸåž‹ | â³ è§„åˆ’ä¸­ |
| Phase 2 | JIT ç¼–è¯‘ä¸Žå¼‚æž„åŽç«¯ | ðŸš§ å®žéªŒé˜¶æ®µ |
| Phase 3 | è°ƒè¯• / Profiling å·¥å…·é“¾ | ðŸš§ è§„åˆ’é˜¶æ®µ |
| Phase 4 | AOT æ¡¥æŽ¥ä¸Žå¤–éƒ¨å®¿ä¸»åµŒå…¥ | ðŸ”œ |
| Phase 5 | å®Œæ•´å¼‚æž„ä¼˜åŒ–è°ƒåº¦å™¨ | ðŸ”œ |

---

## 12. æ€»ç»“

Yalivia çš„ç›®æ ‡ä¸æ˜¯æˆä¸ºæ²‰é‡çš„ VMï¼Œ  
è€Œæ˜¯æˆä¸º **NuisLang ä¸Žæœªæ¥ DSL çš„è½»é‡æ‰§è¡Œéª¨æž¶**ã€‚  

å®ƒçš„å­˜åœ¨æ„ä¹‰åœ¨äºŽï¼š
- è®©é™æ€è¯­è¨€å…·å¤‡åŠ¨æ€å®žéªŒä¸Žçƒ­åŠ è½½èƒ½åŠ›ï¼›
- ä¸ºå¼‚æž„è®¡ç®—æä¾›ç»Ÿä¸€ã€å¯æŽ§çš„æ‰§è¡ŒæŠ½è±¡ï¼›
- ä¿è¯ NuisLang çš„è¯­ä¹‰åœ¨ä»»ä½•å¹³å°ä¸Šéƒ½èƒ½ã€Œæœ‰åœ°æ–¹è·‘ã€ã€‚

> **åŽŸç”Ÿæ˜¯ç»ˆç‚¹ï¼ŒYalivia æ˜¯é€šå¾€ç»ˆç‚¹çš„æ¡¥ã€‚**

---